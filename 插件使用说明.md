# 插件使用说明

## 问题：界面显示"示例插件未加载"

### 可能的原因

1. **插件没有被扫描到** - 插件文件不在扫描路径中
2. **插件已扫描但未加载** - 需要手动点击"加载插件"按钮
3. **插件编译失败** - 插件没有正确编译

## 解决步骤

### 1. 检查插件是否已编译

插件编译后应该在以下位置之一：

**Linux:**
```
项目根目录/plugins/libSamplePlugin.so
或
bin/plugins/libSamplePlugin.so
```

**Windows:**
```
项目根目录/plugins/SamplePlugin.dll
或
bin/plugins/SamplePlugin.dll
```

**macOS:**
```
项目根目录/plugins/libSamplePlugin.dylib
或
bin/plugins/libSamplePlugin.dylib
```

### 2. 检查插件扫描路径

程序启动时会自动扫描以下路径（按优先级）：
- `可执行文件目录/plugins/`
- `可执行文件目录/../plugins/`
- `当前工作目录/plugins/`

**查看当前扫描路径：**
- 在界面中，如果没有找到插件，状态栏会显示扫描路径信息
- 或者点击"刷新列表"按钮，查看日志输出

### 3. 确保插件在正确位置

**方法1：使用默认路径（推荐）**

确保插件文件在以下位置之一：
```
frame/
├── bin/
│   └── plugins/
│       └── libSamplePlugin.so  (Linux)
│       └── SamplePlugin.dll    (Windows)
│       └── libSamplePlugin.dylib (macOS)
```

**方法2：配置自定义路径**

编辑配置文件（通常在用户配置目录）：
```json
{
  "framework": {
    "plugins": {
      "enabled": true,
      "scan_paths": [
        "/path/to/your/plugins",
        "/another/path/to/plugins"
      ]
    }
  }
}
```

### 4. 手动加载插件

即使插件被扫描到，也需要**手动点击"加载插件"按钮**来加载：

1. 在插件列表中，找到"示例插件"
2. 点击选中该插件
3. 点击"加载插件"按钮
4. 如果加载成功，插件状态会变为"[已加载]"（绿色）

### 5. 查看详细错误信息

如果加载失败：
- 状态栏会显示错误信息
- 会弹出错误对话框显示详细错误
- 查看日志文件（通常在 `~/.local/share/Eagle/logs/` 或程序目录下的 `logs/`）

### 6. 常见问题排查

#### 问题1：插件列表为空

**原因：** 插件没有被扫描到

**解决方法：**
1. 检查插件文件是否存在
2. 检查插件文件扩展名是否正确（.so/.dll/.dylib）
3. 检查插件路径配置
4. 点击"刷新列表"按钮重新扫描

#### 问题2：插件显示"未加载"

**原因：** 这是正常的！插件需要手动加载

**解决方法：**
1. 选中插件
2. 点击"加载插件"按钮

#### 问题3：加载失败，提示"找不到插件文件"

**原因：** 插件文件路径不正确

**解决方法：**
1. 确认插件文件在扫描路径中
2. 检查文件权限（Linux/macOS需要读取权限）
3. 检查文件是否损坏

#### 问题4：加载失败，提示"插件未实现IPlugin接口"

**原因：** 插件代码有问题

**解决方法：**
1. 检查插件是否继承自 `IPlugin`
2. 检查是否使用了 `Q_PLUGIN_METADATA` 和 `Q_INTERFACES`
3. 重新编译插件

#### 问题5：加载失败，提示"缺少依赖"

**原因：** 插件依赖其他插件或库

**解决方法：**
1. 先加载依赖的插件
2. 确保依赖的库文件在系统路径中

## 使用流程

### 第一次使用

1. **编译项目**
   ```bash
   qmake EagleFramework.pro
   make
   ```

2. **检查插件是否编译成功**
   ```bash
   ls plugins/  # 应该看到 libSamplePlugin.so (Linux)
   ```

3. **运行程序**
   ```bash
   ./bin/EagleApp
   ```

4. **在界面中操作**
   - 如果看到"示例插件"在列表中，说明扫描成功
   - 点击选中"示例插件"
   - 点击"加载插件"按钮
   - 如果状态变为"[已加载]"（绿色），说明加载成功

### 日常使用

1. 启动程序
2. 在插件列表中选择要使用的插件
3. 点击"加载插件"按钮
4. 使用插件功能（双击插件可以打开插件界面）

## 调试技巧

### 查看日志

日志文件位置：
- Linux: `~/.local/share/Eagle/logs/eagle_YYYYMMDD.log`
- Windows: `%APPDATA%/Eagle/logs/eagle_YYYYMMDD.log`
- macOS: `~/Library/Application Support/Eagle/logs/eagle_YYYYMMDD.log`

### 启用详细日志

在代码中设置日志级别：
```cpp
Eagle::Core::Logger::setLogLevel(Eagle::Core::LogLevel::Debug);
```

### 检查插件元数据

插件必须正确实现 `metadata()` 方法：
```cpp
PluginMetadata SamplePlugin::metadata() const
{
    PluginMetadata meta;
    meta.pluginId = "com.eagle.sample";  // 必须唯一
    meta.name = "示例插件";
    meta.version = "1.0.0";
    // ...
    return meta;
}
```

## 快速检查清单

- [ ] 插件文件已编译（.so/.dll/.dylib）
- [ ] 插件文件在扫描路径中
- [ ] 插件文件有读取权限
- [ ] 插件实现了 IPlugin 接口
- [ ] 插件使用了 Q_PLUGIN_METADATA
- [ ] 点击了"刷新列表"按钮
- [ ] 点击了"加载插件"按钮
- [ ] 查看了错误信息（如果有）

## 联系支持

如果以上方法都无法解决问题，请：
1. 查看日志文件中的错误信息
2. 截图错误对话框
3. 提供系统信息（操作系统、Qt版本等）
