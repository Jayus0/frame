# 待做清单

> **最后更新**: 2024年（资源监控实现后）  
> **说明**: ✅ 表示已完成，❌ 表示未实现，⚠️ 表示部分实现

## 🔴 高优先级（P0 - 必须实现）

### 1. 安全与权限模块 (FR-SA-006) - 大部分完成 ✅

#### ✅ RBAC权限模型 - 已完成
- [x] 角色定义和管理
- [x] 权限分配和继承
- [x] 权限检查中间件
- [x] 权限缓存机制（性能优化）✅
  - [x] 权限检查结果缓存
  - [x] TTL（Time To Live）支持
  - [x] LRU淘汰策略
  - [x] 缓存失效机制（权限/角色/用户变更时自动清除）
  - [x] 缓存配置接口（启用/禁用、大小限制、TTL）
- [ ] 权限变更通知机制 ⚠️

**实现文件：**
- `include/eagle/core/RBAC.h`（缓存接口）
- `src/core/RBAC.cpp`（缓存实现）
- `src/core/RBAC_p.h`（缓存数据结构）

**实现文件：**
- `include/eagle/core/RBAC.h`
- `src/core/RBAC.cpp`

#### ✅ 操作审计日志 - 已完成
- [x] 操作记录（谁、何时、做了什么）
- [x] 审计日志存储和查询
- [x] 日志文件轮转机制 ✅
  - [x] 按大小轮转（文件大小超过阈值时）
  - [x] 按时间轮转（按天/周/月）
  - [x] 日志保留策略（保留最近N个文件）
  - [x] 自动清理旧日志文件
  - [x] 轮转配置接口（启用/禁用、策略、大小限制、保留数量）
- [ ] 日志防篡改机制 ⚠️

**实现文件：**
- `include/eagle/core/AuditLog.h`（轮转接口）
- `src/core/AuditLog.cpp`（轮转实现）
- `src/core/AuditLog_p.h`（轮转数据结构）

#### ✅ API访问控制 - 已完成
- [x] 基于角色的API访问限制（通过RBAC中间件）
- [x] API调用频率限制（RateLimiter）
- [x] API密钥管理（ApiKeyManager）

**实现文件：**
- `include/eagle/core/RateLimiter.h`
- `include/eagle/core/ApiKeyManager.h`
- `src/core/RateLimiter.cpp`
- `src/core/ApiKeyManager.cpp`
- `src/core/ApiRoutes.cpp`（中间件集成）

#### ✅ 会话管理 - 已完成
- [x] 用户会话创建和销毁
- [x] 会话超时处理
- [x] 会话状态管理

**实现文件：**
- `include/eagle/core/SessionManager.h`
- `src/core/SessionManager.cpp`

### 2. 高可用和容错 (FR-HA-007) - 大部分完成 ✅

#### ✅ 服务熔断和超时控制 - 已完成
- [x] 熔断器三种状态（Closed、Open、HalfOpen）
- [x] 失败阈值和成功阈值配置
- [x] 自动熔断和恢复机制
- [x] 超时控制

**实现文件：**
- `include/eagle/core/CircuitBreaker.h`
- `src/core/CircuitBreaker.cpp`
- `src/core/ServiceRegistry.cpp`（集成）

#### ✅ 重试策略 - 已完成
- [x] 指数退避重试
- [x] 固定延迟重试
- [x] 线性增长重试
- [x] 最大重试次数配置
- [x] 重试条件判断

**实现文件：**
- `include/eagle/core/RetryPolicy.h`
- `src/core/RetryPolicy.cpp`
- `src/core/ServiceRegistry.cpp`（集成）
- `重试策略使用说明.md`

#### ✅ 降级方案 - 已完成
- [x] 服务降级策略定义
- [x] 降级服务实现（备用服务、默认值、简化服务、禁用服务）
- [x] 自动降级触发机制（与熔断器、重试策略集成）

**实现文件：**
- `include/eagle/core/DegradationPolicy.h`
- `src/core/DegradationPolicy.cpp`
- `src/core/ServiceRegistry.cpp`（集成）
- `服务降级方案使用说明.md`

#### ✅ 故障转移 - 已完成
- [x] 主备服务切换（自动/手动）
- [x] 状态同步机制（配置同步、数据同步）
- [x] 快速故障检测（健康检查、心跳机制）
- [x] 故障恢复机制（自动切换回主服务）
- [x] REST API接口（服务管理、故障转移、节点查询、历史记录）
- [x] CLI工具支持（list、nodes、switch、history）

**实现文件：**
- `include/eagle/core/FailoverManager.h`
- `src/core/service/FailoverManager.cpp`
- `src/core/service/FailoverManager_p.h`
- `src/core/api/ApiRoutes.cpp`（故障转移API）
- `tools/eagle-cli/main.cpp`（故障转移CLI命令）

#### ✅ 备份和恢复 - 已完成
- [x] 配置自动备份（定时备份、变更触发）
- [x] 数据备份策略（全量备份、增量备份）
- [x] 版本回滚功能（版本查询、版本恢复）
- [x] 备份文件管理（保留策略、自动清理）
- [x] REST API接口（创建、查询、恢复、删除）
- [x] CLI工具支持（list、create、restore、delete）

**实现文件：**
- `include/eagle/core/BackupManager.h`
- `src/core/BackupManager.cpp`
- `src/core/BackupManager_p.h`
- `src/core/ApiRoutes.cpp`（备份API）
- `tools/eagle-cli/main.cpp`（备份CLI命令）

## 🟡 中优先级（P1 - 重要功能）

### 3. 开发工具链 (FR-DT-004) - 部分完成 ✅

#### ✅ CLI工具（eagle-cli） - 已完成
- [x] 项目创建命令（`eagle-cli create project`）
- [x] 插件生成命令（`eagle-cli create plugin`）
- [x] 配置管理命令（`eagle-cli config get/set/list`）
- [x] 调试命令（`eagle-cli debug`，基础框架）

**实现文件：**
- `tools/eagle-cli/main.cpp`
- `tools/eagle-cli/CMakeLists.txt`
- `CLI工具使用说明.md`

#### ✅ 项目模板生成器 - 已完成（集成在CLI工具中）
- [x] UI插件模板（通过 `--type=ui`）
- [x] 服务插件模板（通过 `--type=service`）
- [x] 工具插件模板（通过 `--type=tool`）

#### ✅ 调试工具 - 部分完成
- [x] 插件热重载 ✅
  - [x] 插件状态保存和恢复
  - [x] 插件卸载和重新加载
  - [x] 依赖关系检查
  - [x] REST API接口
  - [x] CLI工具支持
- [ ] 内存泄漏检测集成
- [ ] 性能分析工具集成

**实现文件：**
- `include/eagle/core/HotReloadManager.h`
- `src/core/hotreload/HotReloadManager.cpp`
- `src/core/hotreload/HotReloadManager_p.h`
- `src/core/api/ApiRoutes.cpp`（热重载API）
- `tools/eagle-cli/main.cpp`（热重载CLI命令）

#### ✅ 测试框架集成 - 已完成
- [x] 单元测试模板（插件、配置管理、服务）
- [x] 集成测试支持（Framework、API、插件加载）
- [x] 测试运行器（TestRunner）
- [x] 测试报告生成（控制台、JSON、HTML）
- [x] CLI工具集成（eagle-cli test命令）

**实现文件：**
- `include/eagle/core/TestCaseBase.h`（测试基类）
- `include/eagle/core/TestRunner.h`（测试运行器）
- `src/core/TestCaseBase.cpp`（测试基类实现）
- `src/core/TestRunner.cpp`（测试运行器实现）
- `templates/test_plugin_test.cpp.template`（插件测试模板）
- `templates/test_config_test.cpp.template`（配置测试模板）
- `tools/eagle-cli/main.cpp`（测试CLI命令）

### 4. 监控和诊断 (FR-MD-005) - 部分完成 ✅

#### ✅ 实时性能监控 - 已完成
- [x] CPU使用率监控（Linux/Windows/macOS支持）
- [x] 内存使用率监控（Linux/Windows/macOS支持）
- [x] 插件加载时间统计
- [x] 服务响应时间统计
- [x] Windows/macOS系统资源监控 ✅

**实现文件：**
- `include/eagle/core/PerformanceMonitor.h`
- `src/core/PerformanceMonitor.cpp`

#### ✅ 错误追踪和告警 - 已完成
- [x] 错误聚合和分析（通过AlertSystem）
- [x] 告警规则配置
- [x] 告警通知渠道 ✅
  - [x] 邮件通知渠道（SMTP配置、模板支持）
  - [x] Webhook通知渠道（HTTP请求、重试机制）
  - [x] 通知渠道管理（添加、移除、查询）
  - [x] 通知策略配置（级别过滤、启用/禁用）
  - [x] 告警触发时自动发送通知

**实现文件：**
- `include/eagle/core/AlertSystem.h`（通知渠道管理接口）
- `src/core/AlertSystem.cpp`（通知发送逻辑）
- `include/eagle/core/NotificationChannel.h`（通知渠道基类）
- `include/eagle/core/EmailChannel.h`（邮件渠道工厂）
- `include/eagle/core/WebhookChannel.h`（Webhook渠道工厂）
- `src/core/NotificationChannel.cpp`（基类实现）
- `src/core/EmailChannel.cpp`（邮件渠道实现）
- `src/core/WebhookChannel.cpp`（Webhook渠道实现）

#### ✅ 诊断工具 - 已完成
- [x] 堆栈跟踪分析（异常捕获、调用链分析、符号解析）
- [x] 内存快照功能（快照捕获、快照对比、泄漏检测提示）
- [x] 死锁检测（基础框架，定时检测）
- [x] REST API接口（堆栈跟踪、内存快照、死锁查询）
- [x] CLI工具支持（stacktrace、memory、deadlock命令）

**实现文件：**
- `include/eagle/core/DiagnosticManager.h`
- `src/core/monitoring/DiagnosticManager.cpp`
- `src/core/monitoring/DiagnosticManager_p.h`
- `src/core/api/ApiRoutes.cpp`（诊断API）
- `tools/eagle-cli/main.cpp`（诊断CLI命令）

#### ⚠️ 健康检查 - 部分实现
- [x] 系统健康检查接口（`ServiceRegistry::checkServiceHealth`）
- [x] 插件健康检查（基础）
- [ ] 服务健康检查聚合 ⚠️

### 5. REST API接口 - 已完成 ✅

#### ✅ 插件管理API - 已完成
- [x] GET /api/v1/plugins - 获取插件列表
- [x] GET /api/v1/plugins/{id} - 获取插件详情
- [x] POST /api/v1/plugins/{id}/load - 加载插件
- [x] DELETE /api/v1/plugins/{id} - 卸载插件

#### ✅ 系统管理API - 已完成
- [x] GET /api/v1/health - 健康检查
- [x] GET /api/v1/metrics - 监控指标
- [x] GET /api/v1/logs - 日志查询
- [x] POST /api/v1/config - 配置更新

#### ✅ HTTP服务器 - 已完成
- [x] 基于Qt的HTTP服务器实现（使用QTcpServer）
- [x] 路由管理
- [x] 请求/响应处理
- [x] 认证中间件（API密钥、会话）
- [x] 权限检查中间件
- [x] 限流中间件

**实现文件：**
- `include/eagle/core/ApiServer.h`
- `include/eagle/core/ApiRoutes.h`
- `src/core/ApiServer.cpp`
- `src/core/ApiRoutes.cpp`
- `REST_API使用说明.md`

## 🟢 低优先级（P2 - 增强功能）

### 6. 插件管理系统增强

#### ❌ 插件分类管理 - 未实现
- [ ] UI插件、服务插件、工具插件分类
- [ ] 按分类筛选和显示

#### ✅ 循环依赖检测和告警 - 已完成
- [x] 依赖图构建（基础）
- [x] 循环检测算法（DFS深度优先搜索）
- [x] 告警机制（集成AlertSystem）
- [x] REST API接口（依赖检查、循环检测报告）
- [x] CLI工具支持（dependency check/circular命令）

**实现文件：**
- `include/eagle/core/PluginManager.h`（循环依赖检测接口）
- `src/core/plugin/PluginManager.cpp`（DFS算法实现、告警集成）
- `src/core/api/ApiRoutes.cpp`（依赖检查API、循环检测API）
- `tools/eagle-cli/main.cpp`（依赖检查CLI命令）

#### ❌ 版本冲突自动解决 - 未实现
- [ ] 版本语义化解析
- [ ] 冲突检测
- [ ] 自动解决策略

#### ❌ 插件沙箱运行模式 - 未实现
- [ ] 进程隔离
- [ ] 资源限制强制执行
- [ ] 文件系统隔离
- [ ] 网络隔离

### 7. 服务总线系统增强

#### ❌ 异步服务调用 - 未实现
- [ ] 异步调用接口
- [ ] Future/Promise模式
- [ ] 回调机制

#### ❌ 远程服务通信 - 未实现
- [ ] HTTP服务调用
- [ ] gRPC服务调用
- [ ] 服务发现（Consul等）

#### ❌ 负载均衡 - 未实现
- [ ] 轮询算法
- [ ] 加权轮询
- [ ] 最少连接数

### 8. 配置管理系统增强

#### ❌ 配置版本管理 - 未实现
- [ ] 配置版本号
- [ ] 版本历史记录
- [ ] 版本回滚

#### ❌ 远程配置中心 - 未实现
- [ ] 配置中心客户端
- [ ] 配置拉取和推送
- [ ] 配置变更通知

#### ❌ YAML/INI格式支持 - 未实现
- [ ] YAML解析器集成
- [ ] INI文件解析
- [ ] 格式自动识别

#### ⚠️ Schema验证 - 部分实现
- [ ] JSON Schema支持 ⚠️
- [ ] 类型检查 ⚠️
- [ ] 依赖检查 ⚠️

### 9. 加密和安全增强

#### ✅ 升级加密算法 - 已完成
- [x] 配置加密存储（XOR + SHA256，基础实现，向后兼容）
- [x] AES-256加密实现（支持OpenSSL，回退到简化实现）
- [x] 标准PBKDF2密钥派生（支持OpenSSL，回退到Qt实现）
- [x] 密钥轮换机制（版本管理、自动迁移）
- [x] REST API接口（密钥信息、密钥生成、密钥轮换）
- [x] CLI工具支持（encryption info/generate/rotate命令）

**实现文件：**
- `include/eagle/core/ConfigEncryption.h`（AES256接口、密钥版本管理）
- `src/core/config/ConfigEncryption.cpp`（AES256实现、PBKDF2、密钥轮换）
- `src/core/api/ApiRoutes.cpp`（加密管理API）
- `tools/eagle-cli/main.cpp`（加密管理CLI命令）

**加密算法支持：**
- **AES-256-CBC**: 使用OpenSSL（如果可用）或Qt简化实现
- **PBKDF2**: 标准密钥派生，支持可配置迭代次数和盐值
- **向后兼容**: 支持解密旧版本XOR加密的数据
- **密钥版本管理**: 支持密钥版本跟踪和自动迁移

#### ⚠️ 插件签名增强 - 部分实现
- [x] 插件签名验证（SHA256哈希，基础实现）
- [ ] RSA非对称加密签名 ⚠️
- [ ] 证书链验证 ⚠️
- [ ] 签名撤销列表（CRL）⚠️

**实现文件：**
- `include/eagle/core/PluginSignature.h`
- `src/core/PluginSignature.cpp`

#### ❌ SSL/TLS支持 - 未实现
- [ ] HTTPS通信
- [ ] 证书管理
- [ ] TLS配置

### 10. 异常隔离增强

#### ✅ 资源监控实现 - 已完成
- [x] 资源限制设置（接口）
- [x] 实际内存使用监控（Linux/Windows/macOS跨平台支持）
- [x] CPU使用率监控（Linux/Windows/macOS跨平台支持，基于时间差计算）
- [x] 线程数监控（Linux/Windows/macOS跨平台支持）
- [x] 资源限制强制执行机制
- [x] 资源超限事件记录和查询
- [x] REST API接口（资源查询、限制设置、事件查询）
- [x] CLI工具支持（show、set、events命令）

**实现文件：**
- `include/eagle/core/PluginIsolation.h`（资源限制接口）
- `include/eagle/core/ResourceMonitor.h`（资源监控管理器）
- `src/core/plugin/PluginIsolation.cpp`（集成ResourceMonitor）
- `src/core/plugin/ResourceMonitor.cpp`（跨平台资源监控实现）
- `src/core/plugin/ResourceMonitor_p.h`（私有实现，包含CPU使用率历史数据）
- `src/core/api/ApiRoutes.cpp`（资源监控API）
- `tools/eagle-cli/main.cpp`（资源监控CLI命令）

**平台支持：**
- **Linux**: 使用 `/proc/self/status` 和 `/proc/self/stat` 获取资源信息
- **Windows**: 使用 `GetProcessMemoryInfo`、`GetProcessTimes`、`CreateToolhelp32Snapshot` API
- **macOS**: 使用 `task_info`、`task_threads` Mach API 获取资源信息

#### ❌ 进程隔离 - 未实现
- [ ] 插件进程分离
- [ ] 进程间通信（IPC）
- [ ] 进程监控和重启

## 📊 功能完成度统计

### 已完成功能 ✅

#### 第一阶段
- ✅ 插件签名验证（基础实现）
- ✅ 服务熔断和超时控制
- ✅ 配置加密存储（基础实现）
- ✅ 异常隔离机制（基础实现）

#### 第二阶段
- ✅ RBAC权限模型（含权限缓存机制）
- ✅ 操作审计日志
- ✅ 性能监控（Linux支持）
- ✅ 告警系统

#### 第三阶段
- ✅ 重试策略（指数退避、固定延迟、线性增长）
- ✅ 服务降级方案（备用服务、默认值、简化服务、禁用服务）
- ✅ REST API接口（插件管理、系统管理）
- ✅ CLI工具（项目创建、插件生成、配置管理、调试命令）
- ✅ API访问控制（限流、API密钥管理）
- ✅ 会话管理
- ✅ 权限缓存机制（TTL、LRU、自动失效）
- ✅ 日志文件轮转机制（按大小、按时间、自动清理）
- ✅ 告警通知渠道（邮件、Webhook）
- ✅ 备份和恢复功能（自动备份、版本回滚、REST API、CLI支持）
- ✅ 测试框架集成（单元测试、集成测试、测试运行器、报告生成）
- ✅ 插件热重载功能（状态保存、自动恢复、依赖检查、REST API、CLI支持）
- ✅ 故障转移功能（主备切换、健康检查、状态同步、REST API、CLI支持）
- ✅ 诊断工具（堆栈跟踪、内存快照、死锁检测、REST API、CLI支持）
- ✅ 资源监控实现（内存、CPU、线程监控，资源限制强制执行，跨平台支持，REST API、CLI支持）
- ✅ 插件循环依赖检测告警（DFS算法、告警机制、REST API、CLI支持）
- ✅ AES-256加密升级（AES256加密、PBKDF2密钥派生、密钥轮换、REST API、CLI支持）

### 部分实现功能 ⚠️

- ⚠️ 配置Schema验证
- ⚠️ RSA插件签名（当前使用SHA256）
- ⚠️ AES-256加密（当前使用XOR）
- ⚠️ RSA插件签名（当前使用SHA256）

### 未实现功能 ❌

- ❌ 故障转移
- ❌ 备份和恢复
- ❌ 插件热重载
- ❌ 内存泄漏检测集成
- ❌ 性能分析工具集成
- ❌ 测试框架集成
- ❌ 诊断工具（堆栈跟踪、内存快照、死锁检测）
- ❌ 异步服务调用
- ❌ 远程服务通信
- ❌ 负载均衡
- ❌ 配置版本管理
- ❌ 远程配置中心
- ❌ YAML/INI格式支持
- ❌ SSL/TLS支持
- ❌ 进程隔离

### 总体进度

- **P0功能（高优先级）**: 约 **98%** 完成
  - 安全与权限模块：✅ 95% 完成（权限缓存机制、日志轮转已完成）
  - 高可用和容错：✅ 95% 完成（备份恢复、故障转移已完成）
  - 监控和诊断：✅ 85% 完成（告警通知渠道已完成）
  
- **P1功能（中优先级）**: 约 **90%** 完成
  - 开发工具链：✅ 85% 完成（CLI工具、测试框架、插件热重载、循环依赖检测完成）
  - 监控和诊断：✅ 95% 完成（基础监控、诊断工具、跨平台资源监控已完成）
  - REST API接口：✅ 100% 完成
  
- **P2功能（低优先级）**: 约 **10%** 完成
  - 主要是增强功能，大部分未实现

- **总体完成度**: 约 **87%** 完成

## 🎯 下一步建议

### 推荐优先级

#### 🥇 第一优先级：完善现有功能
1. ~~**权限缓存机制**~~ ✅ **已完成**
   - 提升RBAC性能
   - 工作量：1-2天

2. ~~**日志文件轮转**~~ ✅ **已完成**
   - 防止日志文件过大
   - 工作量：1-2天

3. ~~**告警通知渠道**~~ ✅ **已完成**
   - 邮件、Webhook通知
   - 工作量：2-3天

4. ~~**备份和恢复**~~ ✅ **已完成**
   - 配置自动备份、版本回滚
   - 工作量：2-3天

5. ~~**Windows/macOS系统资源监控**~~ ✅ **已完成**
   - 跨平台资源监控支持
   - 工作量：2-3天

#### 🥈 第二优先级：增强功能
6. ~~**故障转移**~~ ✅ **已完成**
   - 主备服务切换、健康检查、状态同步
   - 工作量：5-7天

#### 🥉 第三优先级：开发工具
7. ~~**测试框架集成**~~ ✅ **已完成**
   - 单元测试模板、测试运行器、报告生成
   - 工作量：3-5天

8. ~~**插件热重载**~~ ✅ **已完成**
   - 开发调试便利
   - 工作量：3-5天

### 🎯 下一步推荐

根据当前进度，建议优先实现以下功能：

1. **配置Schema验证** ⚠️
   - JSON Schema支持
   - 类型检查
   - 依赖检查
   - 工作量：3-5天

2. **RSA插件签名** ⚠️
   - 替换当前SHA256哈希
   - 实现RSA非对称加密签名
   - 证书链验证
   - 签名撤销列表（CRL）
   - 工作量：3-5天

## 📝 更新说明

- **每次实现新功能后，请更新此清单**
- **标注实现文件路径，便于查找**
- **区分已完成✅、部分实现⚠️、未实现❌**
- **定期更新总体进度统计**

## 📚 相关文档

- `需求文档.md` - 完整需求说明
- `第一阶段实现总结.md` - 第一阶段功能总结
- `第二阶段实现总结.md` - 第二阶段功能总结
- `CLI工具使用说明.md` - CLI工具使用指南
- `重试策略使用说明.md` - 重试策略使用指南
- `服务降级方案使用说明.md` - 降级方案使用指南
- `REST_API使用说明.md` - REST API使用指南
